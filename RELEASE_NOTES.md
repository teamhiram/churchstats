# リリースノート

## v0.20.2 (2026-02-28)

### 変更点

- **個人ページ 500 エラー解消:** 本番環境で個人ページ（名簿のメンバー個別ページ）を開くと 500 になる不具合を修正。在籍メモ表示で使っていたライブラリが本番サーバーで別パッケージを「許可されていない読み込み方」で呼んでいたため、サーバー側で DOMPurify を読まないようにし、初回は安全なテキストのみ表示・クライアントでサニタイズして差し替える方式に変更（詳細は `_RealeaseNotes/0.20.2.md`）。
- **バージョン表示:** ヘッダーのバージョンバッジを 0.20.2 に更新。

---

## v0.20 (2026-02-27)

### 変更点

- **地方選択ポップアップ:** 地域タブ（北海道・東北、北関東、南関東など）がクリック／タップで反応しない不具合を修正。ポップアップ本体に `z-[101]` を付与してオーバーレイより前面にし、タブに `onPointerDown` を追加してタッチでも確実に切り替わるようにした。あわせてオーバーレイのバックドロップクリックでポップアップを閉じるようにした。
- **バージョン表示:** ヘッダーのバージョンバッジを 0.20 に更新。

---

## v0.19 (2026-02-26)

### 変更点

- **バージョン表示:** ヘッダーのバージョンバッジを 0.19 に更新。
- **集会重複検知:** 「出席者0を一括選択」ボタン追加。選択列ヘッダーをチェックボックスにし、そのチェックでグループ内を一括選択。セクション右上の「このグループを選択」は削除。
- **各種数値:** 「登録集会数」セクションを追加（主日集会・小組集会・派遣件数）。「出欠レコード数」を「主日集会延べ人数」にラベル変更。
- **デバッグサイドバー:** 集会重複検知・重複出席・在籍期間不確定の各リンクに、該当件数を赤バッジで表示。在籍期間不確定のラベルを「在籍期間不確定リスト」から「在籍期間不確定」に変更。
- **設定ページのスクロール:** 設定／デバッグ画面ではスクロール時にサイドバーは固定し、右側のメインコンテナのみスクロールするように変更（main と MainContentWrapper の overflow を調整、SettingsShell で右カラムのみスクロール）。
- **モバイルUI:** スマホでアカウント（人型）ボタンをヘッダーからフッター右端へ移動。設定サブメニューはスマホ時サイドバーを出さずモーダルのみにし、リストをコンパクト化。設定モーダルがフッターを隠さないよう下マージンを追加。設定以外の画面に左右余白（px-4 / md:px-6）を追加。スマホで地方選択を表示（複数地方時はヘッダー右に地方名＋▼、タップで共通ポップアップ）。

---

## v0.18 (2026-02-26)

### 変更点

- **ログイン履歴:** ログイン成功時に `login_logs` テーブルへ1行記録するように実装。`user_id`・`email`・`user_agent` を保存。従来テーブルと RLS は存在したが挿入処理がなく常に空だったため、`LoginForm` の `signInWithPassword` 成功後に insert を追加。挿入失敗時もログインは成功したままリダイレクトする。
- **設定まわり:** ヘッダーの「設定」をドロップダウンからリンクに変更。設定画面は左サイドバー＋右コンテンツのレイアウトに。サイドバーに枠組設定・システム設定・ユーザ・ロール管理（グローバル管理者のみ）・デバッグ（管理者のみ。各種数値・全テーブル・在籍期間不確定リスト・重複出席）。デバッグ項目はアンバー色で区別。サイドバーを隠す／表示するボタンあり。アカウント詳細は人のアイコンでヘッダー右端に配置。
- **システム設定:** 「ユーザー・ロール管理」セクションを削除し、サイドバーから遷移する形に。ユーザ・ロール管理ページで名前の下にメールアドレスを表示。
- **設定画面レイアウト:** 一番外のコンテナは左右・下の余白をなくし、上はヘッダーと重ならないように余白を確保。
- **全テーブル:** 「在籍期間不確定リスト」「集会重複検知」へのリンクを削除。在籍期間不確定リストはデバッグサイドバーから直接遷移。

---

## v0.17 (2026-02-26)

### 変更点

- **地方マスタ:** locality に「海外」「不明」の選択肢を追加（マイグレーション 037）。どちらも都道府県に属さない特殊地方として登録され、地方切り替え・名簿で選択可能。
- **出欠登録:** 地方を切り替えたあと（例: 酒田を選択）に出欠登録を開いても、URL に他地方の地区 ID が残っていても、現在選択中の地方の地区で正しく表示・登録されるように修正。`effectiveDistrictIdForCurrentLocality` で URL の `district_id` を現在地方に属する場合のみ採用。
- **名簿管理:** 地方区別に伴う表示・フィルタの不具合を解消。
- **ドキュメント:** 出欠関連テーブル一覧（`docs/attendance-related-tables.md`）に「DB 上の地方（locality）による区別」を追記。多地方運用記録（`docs/multi-region-implementation-record.md`）にパフォーマンスのメモ（Rendering の cache 抑止・Compiling の Turbopack 案）を追加。
- **パフォーマンス:** 同一リクエスト内で `getCachedLocalities` / `getCachedAreas` / `getCachedPrefectures` の重複呼び出しを抑止するため、React の `cache()` でラップ。レイアウト・集会ページ・地方 ID 解決で何度呼ばれても DB アクセスは 1 回にまとまる。

---

## v0.11 (2025-02-11)

### 変更点

- **ダッシュボードのグラフ:** 棒グラフの色分けオプション（集計のみ / 信仰別 / 年代別 / 地区別）のラベル「棒グラフの色分け」を削除。機能はそのまま利用可能。
- **出欠登録:** フリガナ順に付随していた「五十音グループ」トグルを削除。フリガナ順選択時は常に「あ」「か」「さ」「た」…の行ごとにグルーピング（主日・祈祷会・小組・オーガニック出欠の全ページ）。
- **出欠登録:** アコーディオンラベルを「フリー検索・並び順・グルーピング」から「表示設定（フリー検索・並べ順・グルーピング）」に変更。
- **出欠登録:** グルーピング1層目に「出欠別」を追加。出席・欠席の順で表示（主日・祈祷会・小組・オーガニック出欠の全ページ）。
- **出欠登録:** グルーピング機能の改定（4ページ共通）。①グルーピング1層目に「五十音別」を追加（並び順のフリガナ順と同機能）。②グルーピング2層目を設置（1層目設定時のみ表示、1層目以外の項目を選択可能）。③グループタイトルをアコーディオン化（デフォルトはオープン）。
