# ChurchStats v0.12

2026/02/19

ダッシュボードの週別主日出席グラフのUX改善を行ったバージョン。

## 本バージョンでの追加・変更内容

### 凡例のインタラクティブトグル化

信仰別・年代別・地区別のいずれかを選択した際に表示される凡例を、クリック可能なトグルボタンに変更した。

- 各凡例項目がボタンとして表示され、対応する系列の色を継承したカラーチップ付き。
- 初期状態はすべてON（表示中）。クリックするとグレーアウトし、グラフ上の対応するバーが非表示になる。
- 再度クリックすると元の色に戻り、バーも再表示される。
- グルーピング（信仰別↔年代別↔地区別）を切り替えるとトグル状態は自動リセット。
- 例：地区別で「調布地区」「稲城地区」がボタンとして並び、個別にOn/Off可能。

### Y軸の余裕確保

- 棒グラフ上部に表示される合計人数ラベルが見切れる問題を修正。
- Y軸の最大値をデータ最大値の115%に設定し、ラベルが確実に表示されるようにした。

---

## 影響範囲

| 対象 | 変更内容 |
|------|----------|
| `StatisticsCharts.tsx` | Recharts `<Legend>` を削除し、カスタムトグルボタン凡例を実装。`hiddenSeries` state で表示/非表示を管理。Y軸 domain に15%マージン追加。 |

---

## 確認ポイント

- [ ] 信仰別で「聖徒」をOFFにして「友人」だけ表示されること
- [ ] 地区別で特定地区をOFFにしてグラフから消えること
- [ ] 年代別で複数カテゴリをOFFにして正しくスタックされること
- [ ] グルーピング切り替え時にトグル状態がリセットされること
- [ ] 棒グラフ上の数字ラベルが切れないこと
- [ ] 「集計のみ」選択時にトグルボタンが表示されないこと
