# ChurchStats v0.13

2026/02/19

ダッシュボード・ナビゲーション・UIコンポーネントの全体的なリファインを行ったバージョン。

## 本バージョンでの追加・変更内容

### ダッシュボード

- **集計セルのコンパクト化**: トップの地方・地区・小組・メンバー表示のパディング・フォントを縮小し、省スペース化。
- **派遣モニターのアコーディオン化**: デフォルトで折りたたまれた状態に変更。未派遣者数をバッジで常時表示。クリックで展開・折りたたみ。
- **集会登録数の移動**: ダッシュボードから削除し、デバッグ「各種数値」ページに移動。

### デバッグ「各種数値」ページ（新規）

- `/debug/numbers` に新規作成。集会登録数・メンバー登録数・地区数・小組数・出欠レコード数を一覧表示。
- ナビゲーションのデバッグメニューに「各種数値」リンクを追加。

### ページタイトルの削除

- グローバルナビがタイトル代わりのため、各ページの `<h1>` タイトルをすべて削除。
- エラーページ・ログイン画面・個別エンティティ名（メンバー名・集会名）の表示は維持。

### スマホ固定ヘッダー（新規）

- モバイルのみ表示される薄い固定ヘッダーを追加。
- 背景はフッターと同じ `bg-slate-800`、「召会生活統計システム」の白文字。
- バージョン番号を `bg-primary-600` のバッジで上付き表示。

### スマホフッターナビのリスタイル

- 背景を `bg-white` → `bg-slate-800`（ダークテーマ）に変更。
- 通常: `text-slate-300`（薄い白文字）、Active: `text-white bg-primary-600`（ブランドカラーベタ塗り）。
- サブメニュー（設定・デバッグ）も同系統のダークテーマに統一。
- 高さを縮小してコンパクトに。

### チャートのUI微調整

- チャートフィルターボタンをフラットなマテリアルデザインに変更（インナーシャドウ・ボーダー削除、パディング縮小）。
- チャートカードの左余白を縮小。
- 「グラフをPNGでダウンロード」ボタンを右寄せ配置にし、ダウンロードアイコンを追加。

### 出欠マトリクスのセル色統一

- 色が付くセル（祈り・主日・小組・派遣）のボーダーを塗り色と同じ色に変更。

### トグルスイッチのリデザイン

- Mac 新テーマ風のフラットなデザインに全面変更。
- トラック: `h-6 w-11` のピル型、OFFは `bg-slate-200`、ONはテーマ色。
- ノブ: `h-5 w-5` の白い円形、軽いシャドウ付き。
- ON のときつまみは右、OFF のときつまみは左。

---

## 影響範囲

| 対象 | 変更内容 |
|------|----------|
| `dashboard/page.tsx` | 集計セルコンパクト化、集会登録数削除、h1削除 |
| `DispatchMonitor.tsx` | アコーディオン化、未派遣バッジ |
| `AttendanceMatrix.tsx` | セルボーダーを塗り色に統一 |
| `debug/numbers/page.tsx` | 新規作成（各種数値ページ） |
| `Nav.tsx` | スマホヘッダー追加、フッターダークテーマ化、デバッグメニューに「各種数値」追加 |
| `layout.tsx` | スマホの上下パディング調整 |
| `StatisticsCharts.tsx` | フィルターボタンフラット化、左余白縮小、DLボタン右寄せ+アイコン |
| `Toggle.tsx` | Mac新テーマ風リデザイン |
| 15ページ | h1タイトル削除 |

### 週別集計アコーディオンの強化

- **主日集会の出欠サブセクション**: 出席者と欠席者を分けて表示。欠席者の名前を赤色で表示し、欠席メモがあればカッコ付きで併記。
- **セクションタイトルに編集リンク追加**: 主日集会・祈りの集会・小組・派遣先の各タイトル横に鉛筆アイコンを追加。クリックで該当週の出欠編集画面に直接遷移。

| 対象 | 変更内容 |
|------|----------|
| `types.ts` | `WeekDetail` に `mainAbsent` フィールド追加 |
| `actions.ts` | `getWeekDetail` で欠席者（`attended: false`）とメモを取得 |
| `MeetingsListTable.tsx` | 出席/欠席サブセクション表示、鉛筆アイコンリンク追加 |

### 欠席コメントが保存されないバグの修正

- 名簿に表示されているが出欠トグルを触っていないメンバー（最初から欠席の人）のコメントが保存されない問題を修正。
- 保存時に、名簿上の全メンバー（除外者以外）を `attended: false` として `attendanceMap` に補完するようにした。

| 対象 | 変更内容 |
|------|----------|
| `SundayAttendance.tsx` | 保存処理で roster 全員を attendanceMap に補完（欠席コメント保存対応） |
